\chapter{Novo cluster: instalação e gerência}

\textbf{Motivação:} $\star\star\star\star\star$\\

\textbf{Tipo:} Projeto que se tornará atividade.\\

\textbf{Descrição:} Este projeto trata da instalação do novo cluster do Laboratório 
de Termohidráulica e Neutrônica do CDTN (LTHN). Este sistema compreende uma máquina mestra e 8 máquinas escravas, todas equipadas com placas gráficas Nvidia que podem ser utilizadas tanto para visualização quanto para cálculos em paralelo.

O sistema está parcialmente instalado com Linux CentOS 7.5 com um serviço de 
sistema de arquivos distribuído Gluster ativo. Atualmente o sistema também tem 
o sincronismo de timestamp entre nós e mestre. Isso é fundamental para evitar 
erros de sincronismo de arquivos (data mismatch).

O objetivo final deste projeto é ter o cluster funcionando com usuários com cotas 
de disco e com os seguintes sistemas instalados:

\begin{itemize}
	\item \textbf{Serpent2 Monte Carlo [INSTALADO]};
	\item \textbf{MCNP 6 [INSTALADO]};
	\item \textbf{OpenFOAM versão 6 [INSTALADO]};
	\item \textbf{Pacote ANSYS [INSTALADO]};
	\item SCALE;
	\item \textbf{Matlab [INSTALADO (aguardando testes do Prana)]}.
\end{itemize}

No presente momento, o sistema NAS está instalado em modo padrão, com duas 
interfaces de rede 10Gbits conectadas as switch do cluster (endereços IP:\texttt{nas1: 13.13.13.51} e \texttt{nas2: 13.13.13.52}) e uma interface 
1Gb conectada à rede do CDTN. A arquitetura a ser usada no NAS ainda está sendo 
estudada, mas já foi configurado um volume em RAID 10 para o backup das máquinas 
do LTHN.

A autenticação é feita tanto com chaves públicas e privadas com SSH mas também 
está instalado o serviço RSH para autenticação sem criptografia. Isso funciona 
apenas internamente, entre máquinas do cluster e o master. O método 
\textit{hostbased authentication} falhou nas tentativas de configuração e, portanto, foi abandonado até um segundo momento, sendo utilizadas as duas 
formas acima de autenticação.\\

\textbf{Sub-atividades}

A partir da situação atual do cluster, as sequintes atividades estão previstas:
\begin{itemize}
%	\item[1] \textbf{Modificação da forma de autenticação dos hosts de chaves 
%	para autenticação no host}. Isso é fundamental para simplificar a criação 
%	de contas de usuários e diminuir o volume de dados de chaves armazenadas em 
%	um diretório \texttt{/home} compartilhado\footnote{"As configurações do \textit{host based authentication} falharam. Mais esforços serão empregados até um limite de tempo razoável. No entanto, caso o problema persista, será utilizada a solução atual com chaves públicas e primárias por usuário. Esta solução torna mais custosa a criação de contas de usuários, mas está funcional.};
	\item[1] Instalação e testes dos softwares descritos (falta apenas o SCALE);
	\item[2] Finalizar a instalação do Slurm\footnote{O Torque é o sistema padrão so CentOS. Entretanto, na literatura o Slurm é mais utilizado e será a provável escolha para o nosso cluster.} para lançamento de aplicações e controle de 
	carga de trabalho do sistema;
	\item[3] Implementação de capacidade de visualização remota pelas placas gráficas a partir de outras máquinas Linux do LTHN.
	\item[4] Avaliação da viabilidade de um hub para exploração dos sistemas de segurança do cluster (power supplies e no-break).
	\item[5] Avaliação de implantação de desligamento automático em casa de falta de energia atráves de conexão lógica com o sistema de controle do no-break.
	\item[6] Talvez valha a pena centralizar o repositório de aplicações no NAS, de modo que qualquer eventual instalação seja a partir dele, com apenas o playerone acessando a internet e atualizando esse repositório. Ele seria montado via NAS.
\end{itemize}

As sub-atividades listadas são atualizadas a cada revisão no documento, sendo que 
as sub-atividades finalizadas são removidas da lista e, de acordo com a demanda, 
são acrescidas novas tarefas. Por exemplo, a instalação do NAS ou a instalação do 
matlab, que não estavam no projeto inicial do cluster.\\

Foi instalado o Apache2 como servidor web no playerone para permitir o acompanhamento da carga no cluster via \textbf{Ganglia}. Este foi instalado 
e funciona perfeitamente. Entretanto, não é possível acessar o serviço \texttt{http} no mestre a partir de outras máquinas na rede do CDTN. Como isso 
pode não ser possível devido às restrições da rede, é possível usar (com limitações) o Firefox local via conexão \texttt{ssh} com \textit{X11 Forward}.\\

\textbf{Observações:}

O processo de instalação pode levar a demandas não previstas, de acordo com as avalições feitas para implantação de determinada \textit{feature} no sistema.

Uma vez instalado e testado, o projeto passa a ser uma atividade. Esta atividade 
consiste na manutenção e verificação do funcionamento do sistema.\\

\textbf{\textit{Outcomes}}

\begin{itemize}
	\item[1] Sistema de cálculos para as atividades do LTHN e, eventualmente, para usuários externos.
	\item[2] Paper INAC 2019 com descrição do processo final de instalação e exemplos de aplicações com tempo de execução.

\end{itemize}


\textbf{Dificuldades/Restrições}

O sistema está hoje fora da rede elétrica do gerador.\\

Em 13/12/2018 um dos equipamentos de ar-condionado da sala do cluster falhou. A equipe de manutenção do CDTN foi acionado no mesmo dia.\\

É necessário solicitar a instalação de uma tomada 110V para a ligação do hub 
(disponibilizado pelo Élcio) e dos equipamentos de rede que vão necessitar 
dessas conexãos.\\

Última modificação: \date{\today}

%\date{\today}
